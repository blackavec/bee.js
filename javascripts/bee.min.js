/* 
 * Copyright (C) 2015 Mahan Hazrati Sagharchi <eng.mahan.hazrati@gmail.com>
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

!function(document,window){function beeHoneycomb(){return{xmlhttpRequest:null,resultType:"text",queue:[],validMethods:["get","post","put","head","delete","options","trace","connect","patch","copy","link","unlink","purge"],resultTypes:["text","xml","json"],xmlhttpRequestInit:function(){var e;return e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),this.xmlhttpRequest=e,e},getCountOfObject:function(e,t){var n=0;for(var i in e)e.hasOwnProperty(i)&&++n;return t(n),n},appendToQueue:function(e,t){this.queue.push(e),"function"==typeof t&&t()},arraySerialize:function(e,t){var n=[];for(var i in e)if(e.hasOwnProperty(i)){var r=t?t+"["+i+"]":i,s=e[i];n.push("object"==typeof s?serialize(s,r):encodeURIComponent(r)+"="+encodeURIComponent(s))}return n.join("&")},urlUnserialize:function(e){var t=decodeURIComponent(e).toString(),n=t.split("?"),i="";"undefined"!=typeof n[1]&&(i=n[1].toString().split("#")[0]);var r=[];i&&(r=i.split("&").map(function(e){return e.split("=",2)}));var s={};for(var u in r)s[r[u][0]]=r[u][1];return s},urlStrip:function(e){var t=decodeURIComponent(e).toString(),n=t.split("?");return n[0].toString()},urlQueryString:function(e){var t=decodeURIComponent(e).toString(),n=t.split("?"),i="";return"undefined"!=typeof n[1]&&(i=n[1].toString().split("#")[0]),i},urlHashString:function(e){var t=decodeURIComponent(e).toString(),n=t.split("?"),i="";return"undefined"!=typeof n[1]&&(i=n[1].toString().split("#")[1]),i},queueSearch:function(e){var t=[];for(var n in this.queue){var i=0;for(var r in e)"string"==typeof this.queue[n][r]?this.queue[n][r]!==e[r]&&i++:i++;0===i&&t.push(this.queue[n])}return t.length>0?t[0]:!1},resultData:function(e){if(-1===this.resultTypes.indexOf(e))throw"Bee: Result data invalid type";return this.resultType=e,this},request:function(e){if("string"!=typeof e)throw"Bee: Invalid request";return this.appendToQueue({type:"request",path:e,stripPath:this.urlStrip(e),queryStringArray:this.urlUnserialize(e),queryString:this.urlQueryString(e),hashString:this.urlHashString(e)}),this},method:function(e){if("string"!=typeof e)throw"Bee: Invalid method";if(-1===this.validMethods.indexOf(e.toString().toLowerCase()))throw"Bee: the logged method does not support by bee framework request handler";return this.appendToQueue({type:"method",method:e.toString().toLowerCase()}),this},data:function(e,t,n){if("object"!=typeof t)throw"Bee: Invalid request get data";if(-1===this.validMethods.indexOf(e.toString().toLowerCase()))throw"Bee: the logged method does not support by bee framework request handler for request data";return this.appendToQueue({type:"reqData",method:e.toString().toLowerCase(),data:t,merge:"boolean"==typeof n?n:!0}),this},files:function(e){if("object"!=typeof e)throw"Bee: file's object does not valid";return this.appendToQueue({type:"files",isFile:!0,files:e}),this},noAsync:function(){return this.appendToQueue({type:"async",async:!1}),this},credential:function(e,t){if("string"!=typeof e)throw"Bee: credential username is not valid";if("string"!=typeof t)throw"Bee: credential username is not valid";return this.appendToQueue({type:"credential",username:e,password:t}),this},on:function(e,t){if("string"!=typeof e)throw'Bee: "on" event is not valid';if("function"!=typeof t)throw'Bee: "on" method is not valid';return this.appendToQueue({type:"on",event:e,callback:t}),this},execute:function(){this.xmlhttpRequestInit();var e=this.queueSearch({type:"request"}),t=this.queueSearch({type:"async"}),n=this.queueSearch({type:"method"}),i=this.queueSearch({type:"reqData",method:"get"}),r=this.queueSearch({type:"reqData",method:"post"}),s=this.queueSearch({type:"credential"}),u=this.queueSearch({type:"files"}),o=this.queueSearch({type:"on",event:"beforeSting"}),a=this.queueSearch({type:"on",event:"success"}),h=this.queueSearch({type:"on",event:"cancel"}),c=this.queueSearch({type:"on",event:"fail"}),p=this.queueSearch({type:"on",event:"progress"}),l=e.stripPath,f=this.arraySerialize(i.data),d=[];i.merge===!0&&d.push(e.queryString),d.push(f);var y=d.join("&"),y=y?"?"+y:"",v=e.hashString?"#"+e.hashString:"",g=l+y+v,q=n.method?n.method:"get";this.xmlhttpRequest.open(q,g,"boolean"==typeof t.async?t.async:!0,"string"==typeof s.username?s.username:"","string"==typeof s.password?s.password:"");var m="boolean"==typeof u.isFile?u.files:!1,b=null;if("post"===q.toString().toLowerCase())if(m){var S=new FormData;for(var w in r.data)S.append(w,r.data[w]);for(var w in m)console.log(m[w].name),S.append(m[w].name,m[w]);this.xmlhttpRequest.setRequestHeader("Content-type","multipart/form-data"),b=S}else this.xmlhttpRequest.setRequestHeader("Content-type","text/plain"),b=this.arraySerialize(r.data);var x=this;c&&this.xmlhttpRequest.addEventListener("error",function(){c.callback(this)},!1),h&&this.xmlhttpRequest.addEventListener("abort",function(){h.callback(this)},!1),p&&this.xmlhttpRequest.addEventListener("progress",function(){p.callback(this)},!1),a&&this.xmlhttpRequest.addEventListener("load",function(){var e=null;switch(x.resultType){case"text":e=this.responseText;break;case"xml":e=this.responseXML;break;case"json":try{e=JSON.parse(this.responseText)}catch(t){console.error("bee: json result is not correct. result=empty"),e={}}}a.callback(e)},!0),o&&o.callback(),this.xmlhttpRequest.send(b)},bite:function(){this.execute()},send:function(){this.execute()},commit:function(){this.execute()},sting:function(){this.execute()},spread:function(){this.execute()}}}function beeScript(){return{script:null,queue:[],types:["text/javascript","application/ecmascript","application/javascript","text/vbscript"],queueSearch:function(e){var t=[];for(var n in this.queue){var i=0;for(var r in e)"string"==typeof this.queue[n][r]?this.queue[n][r]!==e[r]&&i++:i++;0===i&&t.push(this.queue[n])}return t.length>0?t[0]:!1},appendToQueue:function(e,t){this.queue.push(e),"function"==typeof t&&t()},scriptObject:function(){return document.createElement("script")},src:function(e){if("string"!=typeof e)throw"Bee: Invalid src";return this.appendToQueue({type:"src",src:e}),this},code:function(e){if("function"!=typeof e)throw"Bee: Invalid code";return this.appendToQueue({type:"code",code:e}),this},type:function(e){if("string"!=typeof e||-1===this.types.indexOf(e))throw"Bee: Invalid type";return this.appendToQueue({type:"type",value:e}),this},async:function(){if(this.queueSearch({type:"defer"}))throw"Bee: Defer already declared";return this.appendToQueue({type:"async",async:!0}),this},defer:function(){if(this.queueSearch({type:"async"}))throw"Bee: Async already declared";return this.appendToQueue({type:"defer",defer:!0}),this},charset:function(e){if("string"!=typeof e)throw"Bee: Invalid language";return this.appendToQueue({type:"charset",charset:e}),this},on:function(e,t){if("string"!=typeof e)throw'Bee: "on" event is not valid';if("function"!=typeof t)throw'Bee: "on" method is not valid';return this.appendToQueue({type:"on",event:e,callback:t}),this},execute:function(){this.script=this.scriptObject();var e=this.queueSearch({type:"code"}),t=this.queueSearch({type:"src"}),n=this.queueSearch({type:"type"}),i=this.queueSearch({type:"async"}),r=this.queueSearch({type:"defer"}),s=this.queueSearch({type:"charset"}),u=this.queueSearch({type:"on",event:"beforeload"}),o=this.queueSearch({type:"on",event:"load"}),a=this.queueSearch({type:"on",event:"error"});i&&(this.script.async=1),r&&(this.script.defer=1),s&&this.script.setAttribute("charset",s.charset),this.script.setAttribute("type",n?n.value:"text/javascript"),e?this.script.innerHTML="("+e.code.toString()+")(document, window);":(this.script.setAttribute("src",t.src),o&&(this.script.onload=function(){o.callback(this)}),a&&(this.script.onerror=function(){a.callback(this)})),u&&u.callback({}),document.getElementsByTagName("head")[0].appendChild(this.script),e&&o&&o.callback({})},bite:function(){this.execute()},send:function(){this.execute()},commit:function(){this.execute()},sting:function(){this.execute()},spread:function(){this.execute()}}}function beeLink(){return{link:null,queue:[],rels:["alternate","archives","author","bookmark","external","first","help","icon","last","license","next","nofollow","noreferrer","pingback","prefetch","prev","search","sidebar","stylesheet","tag","up"],queueSearch:function(e){var t=[];for(var n in this.queue){var i=0;for(var r in e)"string"==typeof this.queue[n][r]?this.queue[n][r]!==e[r]&&i++:i++;0===i&&t.push(this.queue[n])}return t.length>0?t[0]:!1},appendToQueue:function(e,t){this.queue.push(e),"function"==typeof t&&t()},linkObject:function(){return document.createElement("link")},href:function(e){if("string"!=typeof e)throw"Bee: Invalid src";return this.appendToQueue({type:"href",href:e}),this},hrefLang:function(e){if("string"!=typeof e)throw"Bee: Invalid hreflang";return this.appendToQueue({type:"hreflang",hreflang:e}),this},media:function(e){if("string"!=typeof e)throw"Bee: Invalid media";return this.appendToQueue({type:"media",value:e}),this},type:function(e){if("string"!=typeof e)throw"Bee: Invalid type";return this.appendToQueue({type:"type",value:e}),this},rel:function(e){if("string"!=typeof e||-1===this.rels.indexOf(e))throw"Bee: Invalid rel";return this.appendToQueue({type:"rel",rel:e}),this},charset:function(e){if("string"!=typeof e)throw"Bee: Invalid language";return this.appendToQueue({type:"charset",charset:e}),this},on:function(e,t){if("string"!=typeof e)throw'Bee: "on" event is not valid';if("function"!=typeof t)throw'Bee: "on" method is not valid';return this.appendToQueue({type:"on",event:e,callback:t}),this},execute:function(){this.link=this.linkObject();var e=this.queueSearch({type:"href"}),t=this.queueSearch({type:"hreflang"}),n=this.queueSearch({type:"type"}),i=this.queueSearch({type:"rel"}),r=this.queueSearch({type:"charset"}),s=this.queueSearch({type:"on",event:"beforeload"}),u=this.queueSearch({type:"on",event:"load"}),o=this.queueSearch({type:"on",event:"error"});if(r&&this.link.setAttribute("charset",r.charset),this.link.setAttribute("type",n?n.value:"text/css"),!e)throw"Bee: href does not define";if(this.link.setAttribute("href",e.href),!i)throw"Bee: rel does not define";this.link.setAttribute("rel",i.rel),t&&this.link.setAttribute("hreflang",t.hreflang),u&&(this.link.onload=function(){u.callback(this)}),o&&(this.link.onerror=function(){o.callback(this)}),s&&s.callback({}),document.getElementsByTagName("head")[0].appendChild(this.link)},bite:function(){this.execute()},send:function(){this.execute()},commit:function(){this.execute()},sting:function(){this.execute()},spread:function(){this.execute()}}}function beeStyle(){return{style:null,queue:[],queueSearch:function(e){var t=[];for(var n in this.queue){var i=0;for(var r in e)"string"==typeof this.queue[n][r]?this.queue[n][r]!==e[r]&&i++:i++;0===i&&t.push(this.queue[n])}return t.length>0?t[0]:!1},appendToQueue:function(e,t){this.queue.push(e),"function"==typeof t&&t()},styleObject:function(){return document.createElement("style")},code:function(e){if("string"!=typeof e)throw"Bee: Invalid code";return this.appendToQueue({type:"code",code:e}),this},type:function(e){if("string"!=typeof e)throw"Bee: Invalid type";return this.appendToQueue({type:"type",value:e}),this},charset:function(e){if("string"!=typeof e)throw"Bee: Invalid language";return this.appendToQueue({type:"charset",charset:e}),this},on:function(e,t){if("string"!=typeof e)throw'Bee: "on" event is not valid';if("function"!=typeof t)throw'Bee: "on" method is not valid';return this.appendToQueue({type:"on",event:e,callback:t}),this},execute:function(){this.style=this.styleObject();var e=this.queueSearch({type:"code"}),t=this.queueSearch({type:"type"}),n=this.queueSearch({type:"charset"}),i=this.queueSearch({type:"on",event:"beforeload"}),r=this.queueSearch({type:"on",event:"load"});if(n&&this.style.setAttribute("charset",n.charset),this.style.setAttribute("type",t?t.value:"text/css"),!e)throw"Bee: code does not define";this.style.innerHTML=e.code,i&&i.callback({}),document.getElementsByTagName("head")[0].appendChild(this.style),r&&r.callback(this)},bite:function(){this.execute()},send:function(){this.execute()},commit:function(){this.execute()},sting:function(){this.execute()},spread:function(){this.execute()}}}var bee={init:function(){},load:function(part){var partTmp=null;try{eval("partTmp = this."+part+"();")}catch(ex){throw"bee: Module does not available. please visit the documentation."}return partTmp},start:function(e){return this.load(e)},wizz:function(e){return this.load(e)},honeycomb:function(){return new beeHoneycomb},script:function(){return new beeScript},link:function(){return new beeLink},style:function(){return new beeStyle}};window.bee=bee,bee.init()}(document,window);